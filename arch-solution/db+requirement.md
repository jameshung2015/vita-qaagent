# 测试用例管理系统技术需求文档
## 文档信息
| 项目名称 | 测试用例管理系统（大模型友好型） |
|----------|----------------------------------|
| 架构方案 | 关系型数据库 + Elasticsearch 混合架构（方案二） |
| 文档版本 | V1.0 |
| 适用范围 | 系统设计、开发、测试、运维人员 |

## 一、需求概述
### 1.1 业务背景
随着测试用例规模达到10万级，传统纯关系库方案已无法满足高效搜索、精准文本对比、可视化图谱分析的业务需求，同时需对接本地开源大模型，实现测试用例的智能化搜索、差异总结、关联逻辑分析，兼顾数据一致性、性能与低成本落地。

### 1.2 需求目标
#### 1.2.1 业务目标
1.  实现10万级测试用例的全生命周期结构化管理（新增、修改、删除、查询）；
2.  支撑高效全文搜索、精准文本相似度对比、可视化关系/场景图谱分析；
3.  输出标准化数据格式，可直接对接本地开源大模型，降低大模型推理成本与token消耗；
4.  保障测试用例数据安全，支持私有化部署，规避敏感数据泄露风险。

#### 1.2.2 技术目标
1.  基于开源免费组件构建架构，无商业授权成本；
2.  全文搜索响应时间＜100ms，文本对比响应时间＜500ms，图谱渲染流畅无卡顿；
3.  数据同步一致性达标，无丢失、无冗余，支持故障重试；
4.  系统可扩展，后续数据量扩容至百万级可平滑调整；
5.  接口标准化，便于与现有测试管理系统对接。

### 1.3 需求范围
#### 1.3.1 包含范围
1.  存储层：关系型数据库（结构化存储）+ Elasticsearch（文本存储/检索）搭建；
2.  数据同步层：轻量定时批量同步方案实现（Python/Shell脚本）；
3.  核心能力层：ES+IK分词搜索、ES文本相似度对比、标准化JSON图谱+ECharts可视化；
4.  大模型适配层：标准化数据格式输出（JSON/Markdown），支持大模型直接对接；
5.  基础业务层：测试用例、关系、场景的基础增删改查功能。

#### 1.3.2 排除范围
1.  商业组件（如ES企业版、商业大模型API）的集成；
2.  超高并发（＞1000QPS）的架构设计；
3.  分布式事务的复杂实现；
4.  重型图数据库（如Neo4j企业版）的部署与集成；
5.  跨地域多活架构设计。

## 二、总体架构设计
### 2.1 架构层级
采用分层架构设计，从上至下依次为：业务应用层 → 大模型适配层 → 核心能力层 → 数据同步层 → 存储层，各层级职责清晰，数据流转标准化。
```
┌─────────────────────────────────────────────────┐
│ 业务应用层：用例管理、权限控制、操作界面、API网关 │
├─────────────────────────────────────────────────┤
│ 大模型适配层：数据格式转换、冗余过滤、数据聚合  │
├─────────────────────────────────────────────────┤
│ 核心能力层：ES+IK搜索 | ES文本对比 | 图谱JSON+ECharts │
├─────────────────────────────────────────────────┤
│ 数据同步层：轻量定时脚本（Python/Shell）| 一致性校验 │
├─────────────────────────────────────────────────┤
│ 存储层：关系型数据库（结构化存储） | Elasticsearch（文本/检索） │
└─────────────────────────────────────────────────┘
```

### 2.2 核心组件选型
| 架构层级 | 组件名称 | 版本要求 | 选型说明 |
|----------|----------|----------|----------|
| 关系型数据库 | MySQL 社区版 / PostgreSQL 社区版 | ≥8.0 / ≥14 | 免费开源，支持事务与结构化存储，保障数据一致性，开发成本低 |
| Elasticsearch | Elasticsearch 社区版 | ≥7.17 | 免费高性能，支持全文检索与文本相似度计算，适配大模型JSON输出 |
| 分词插件 | IK 分词器 | ≥7.17 | 开源中文分词插件，支持细粒度/粗粒度分词，提升搜索精准度 |
| 数据同步 | Python 脚本（优先）/ Shell 脚本 | Python ≥3.8 | 轻量无额外依赖，开发灵活，便于实现数据格式转换与一致性校验 |
| 图谱可视化 | ECharts | ≥5.0 | 开源免费，支持关系图/力导向图渲染，兼容标准化JSON数据 |
| 大模型适配层 | Flask / Django（Python） | Flask ≥2.0 / Django ≥4.0 | 开源轻量，便于快速开发API接口，实现数据聚合与格式转换 |

## 三、详细功能需求
### 3.1 存储层需求
#### 3.1.1 关系型数据库需求（结构化存储）
为与《测试用例模板 (软件/模型 验收)》中的表头字段对齐，同时兼顾后续 ES 检索与大模型适配，本系统关系库表结构调整如下。

1.  **核心表结构设计**（需满足结构化查询与关联存储，字段标准化）

  **（1）测试用例主表：test_case**

  | 字段名 | 类型 | 约束 | 对应模板列 | 用途说明 |
  |--------|------|------|------------|----------|
  | case_id | VARCHAR(64) | 主键，非空 | 用例编号 | 用例唯一标识，建议采用“项目-模块-子模块_序号”或 UUID 前缀形式，便于与模板及外部系统对齐 |
  | project_name | VARCHAR(128) | 可空 | （可从用例编号或用例来源推导） | 项目/算法大类名称，便于跨项目统计与筛选 |
  | module | VARCHAR(256) | 非空 | 模块 | 模块名称或路径（可多值，以分隔符存储），对应模板中的“模块”列 |
  | feature | VARCHAR(128) | 非空 | 功能 | 简短功能项（1-6 字），用于快速索引 |
  | title | VARCHAR(256) | 非空 | 用例名 | 用例标题/名称，便于报告引用 |
  | precondition | TEXT | 可空 | 前置条件 | 测试执行前需满足的条件或准备，若无则可记录为“无” |
  | steps_path | VARCHAR(256) | 非空 | 操作步骤 | 存储操作步骤文本文件的路径或存储键，实际大文本内容可落在文件系统/对象存储，由 ES 同步全文索引 |
  | expected_result_path | VARCHAR(256) | 非空 | 预期结果 | 存储预期结果文本文件的路径或存储键，与 steps_path 类似 |
  | level | VARCHAR(8) | 非空 | 用例等级 | 用例优先级/级别，枚举：P0/P1/P2/P3，对应模板“用例等级” |
  | source | VARCHAR(64) | 可空 | 用例来源 | 用例来源，枚举/可配置：文档/需求/测试计划/用例库/问题单等 |
  | environment | VARCHAR(128) | 可空 | 测试环境 | 测试环境信息，如“台架/实车/云环境/本地”等 |
  | owner | VARCHAR(64) | 可空 | 测试负责人 | 测试执行人姓名或工号 |
  | status | VARCHAR(16) | 非空 | 测试结果 | 测试结果状态，枚举：OK/NOK/BLOCK/NA，对应模板“测试结果”，默认值：NA |
  | remark | VARCHAR(512) | 可空 | 备注 | 补充信息，如截图路径、缺陷编号、脚本位置等 |
  | priority | VARCHAR(16) | 非空 | （可选映射） | 便于与其他系统/报表复用的抽象优先级，枚举：高/中/低，可从 level 派生（如 P0/P1=高，P2=中，P3=低） |
  | create_time | DATETIME | 非空 | - | 用例创建时间（生成/录入时间），格式 YYYY-MM-DD HH:MM:SS |
  | update_time | DATETIME | 非空 | - | 用例最近更新时间，格式 YYYY-MM-DD HH:MM:SS |
  | executor | VARCHAR(64) | 可空 | - | 实际执行该用例的人，可与 owner 合并或保留区分“责任人”和“执行人”的场景 |

  说明：
  - 模板中的“用例编号/模块/功能/用例名/前置条件/操作步骤/预期结果/用例等级/用例来源/测试环境/测试负责人/测试结果/备注”均在本表中有一一映射或派生关系；
  - `steps_path` 与 `expected_result_path` 保持原有“路径存储”设计，以降低关系库大文本冗余，同时通过 ES 索引保存全文内容；
  - `priority` 字段是为与历史系统及报表对齐的抽象优先级，可由 Agent 或后台逻辑按规则从 `level` 自动推导。

  **（2）用例关系表：case_relation**

  | 字段名 | 类型 | 约束 | 用途说明 |
  |--------|------|------|----------|
  | relation_id | VARCHAR(64) | 主键，非空 | 关系记录主键 |
  | source_case_id | VARCHAR(64) | 非空 | 源用例编号，引用 test_case.case_id |
  | target_case_id | VARCHAR(64) | 非空 | 目标用例编号，引用 test_case.case_id |
  | relation_type | VARCHAR(32) | 非空 | 关系类型，枚举：依赖/关联/阻塞/衍生 |
  | remark | VARCHAR(512) | 可空 | 关系说明，例如“安全用例依赖基础登录用例”等 |
  | create_time | DATETIME | 非空 | 创建时间 |

  **（3）场景表：case_scene**

  | 字段名 | 类型 | 约束 | 用途说明 |
  |--------|------|------|----------|
  | scene_id | VARCHAR(64) | 主键，非空 | 场景主键标识 |
  | scene_name | VARCHAR(256) | 非空 | 场景名称，例如“登录成功场景”“登录失败场景”等 |
  | scene_desc_path | VARCHAR(256) | 可空 | 场景描述文本路径或存储键，可存放详细业务场景说明 |
  | create_time | DATETIME | 非空 | 创建时间 |

  **（4）场景与用例映射表：case_scene_mapping**

  | 字段名 | 类型 | 约束 | 用途说明 |
  |--------|------|------|----------|
  | mapping_id | VARCHAR(64) | 主键，非空 | 映射记录主键 |
  | scene_id | VARCHAR(64) | 非空 | 场景主键，引用 case_scene.scene_id |
  | case_id | VARCHAR(64) | 非空 | 用例主键，引用 test_case.case_id |
  | create_time | DATETIME | 非空 | 创建时间 |

2.  **索引设计**
  -  单字段索引：
     -  `test_case`：`module`、`feature`、`level`、`priority`、`status`、`create_time`；
     -  `case_relation`：`source_case_id`、`target_case_id`；
     -  `case_scene_mapping`：`scene_id`、`case_id`；
  -  联合索引：
     -  `test_case`：(`title` + `module`) 或 (`feature` + `module`)，提升组合查询性能（如“模块 + 功能 + 等级”检索）；
  -  所有时间字段统一使用 `YYYY-MM-DD HH:MM:SS` 格式，便于与 ES `date` 字段映射。

3.  **数据格式要求**
  -  所有字段值标准化：
     -  `level` 枚举：P0/P1/P2/P3；
     -  `status` 枚举：OK/NOK/BLOCK/NA；
     -  `priority` 枚举：高/中/低（可由 level 自动映射）；
     -  时间字段统一格式 `YYYY-MM-DD HH:MM:SS`；
  -  查询结果可直接转换为 JSON / JSONL，字段命名遵循英文小写+下划线规范（如对外可映射为 `case_id`、`module`、`feature`、`precondition`、`steps`, `expected_result` 等），无需额外清洗，可直接对接大模型与同步至 ES。

#### 3.1.2 Elasticsearch需求（文本存储+检索，核心）
1.  **索引设计**
    -  索引名称：test_case_index（只读，按时间可分索引，如test_case_index_202512）；
    -  分片与副本：分片数=1（10万级数据无需多分片），副本数=1（保障高可用）；
    -  字段映射（核心，大模型友好）：
        | 字段名 | 字段类型 | 分词配置 | 非空 | 用途说明 |
        |--------|----------|----------|------|----------|
        | case_id | keyword | 无 | 是 | 用例主键，精准匹配 |
        | title | text | ik_max_word（细粒度）+ ik_smart（粗粒度） | 是 | 用例标题，全文搜索 |
        | module_id | keyword | 无 | 是 | 模块ID，精准筛选 |
        | module_name | text | ik_smart | 是 | 模块名称，模糊搜索 |
        | priority | keyword | 无 | 是 | 优先级，精准筛选 |
        | status | keyword | 无 | 是 | 执行状态，精准筛选 |
        | steps | text | ik_max_word | 是 | 用例步骤（大文本），全文搜索+相似度对比 |
        | expected_result | text | ik_max_word | 是 | 预期结果（大文本），全文搜索+相似度对比 |
        | executor | keyword | 无 | 否 | 执行人，精准筛选 |
        | create_time | date | 无 | 是 | 创建时间，范围筛选 |
        | scene_ids | keyword | 无 | 否 | 关联场景ID列表，精准筛选 |
        | scene_names | text | ik_smart | 否 | 关联场景名称，模糊搜索 |
2.  **存储内容要求**
    -  同步关系型数据库的所有核心属性，保持字段名一致；
    -  存储test_case表中steps、expected_result的完整大文本内容（替代关系库的文件路径存储）；
    -  存储case_scene_mapping关联的scene_ids与scene_names，支持场景维度搜索；
3.  **相似度配置要求**
    -  采用TF-IDF算法（ES默认similarity配置），支持文本字段（steps、expected_result、title）的相似度计算；
    -  支持自定义相似度阈值（如≥80%判定为高相似度），便于对比功能筛选结果；
4.  **数据格式要求**
    -  所有数据以JSON格式存储与返回，字段类型清晰，无嵌套冗余结构；
    -  搜索结果返回文本片段（highlight），便于大模型快速提取关键信息，减少token消耗。

### 3.2 数据同步层需求（轻量定时批量方案）
1.  **同步方式**：采用Python定时脚本（优先）实现批量同步，支持Shell脚本备选；
2.  **同步触发条件**
    -  自动触发：固定时间间隔（默认30分钟，可配置，支持1-60分钟调整）；
    -  手动触发：支持通过系统界面/API手动触发全量/增量同步，满足紧急场景需求；
3.  **同步流程需求**
    1.  数据提取：脚本连接关系型数据库，通过主键（case_id、scene_id）筛选新增/修改/删除的数据（基于更新时间字段create_time/update_time）；
    2.  格式转换：将提取的结构化数据转换为ES索引要求的JSON格式，补充大文本内容（steps、expected_result）；
    3.  ES写入：通过ES Rest API实现数据的批量新增（index）、更新（update）、删除（delete）；
    4.  一致性校验：对比关系库主键列表与ES索引主键列表，输出差异数据日志，自动重试失败数据；
    5.  日志记录：记录同步时间、同步数据量、成功/失败数量、失败原因，便于问题排查；
4.  **同步内容范围**
    -  增量同步：新增/修改的test_case、case_relation、case_scene、case_scene_mapping数据；
    -  全量同步：所有上述表的完整数据（手动触发/定时兜底，默认每24小时一次全量比对）；
    -  删除同步：关系库删除的数据，同步删除ES对应索引数据，避免脏数据；
5.  **一致性保障需求**
    -  主键唯一约束：以case_id作为ES索引的文档ID，避免重复数据；
    -  失败重试机制：同步失败时（如ES服务不可用），自动重试3次，间隔5秒，仍失败则记录日志并告警；
    -  兜底校验：每日凌晨执行全量数据比对，修复增量同步遗漏的数据；
6.  **性能要求**：10万级数据全量同步时间＜30分钟，增量同步（＜1000条）时间＜1分钟。

### 3.3 核心能力支撑需求
#### 3.3.1 搜索能力（Elasticsearch + IK分词）
1.  **搜索场景支持**
    -  全文搜索：支持对title、steps、expected_result、scene_names的中文全文搜索，基于IK分词实现精准匹配；
    -  模糊搜索：支持关键词模糊匹配（如“登录”匹配“账号密码登录”“手机号登录”），基于ik_max_word细粒度分词；
    -  精准搜索：支持对case_id、module_id、priority、status、scene_ids的精准匹配搜索；
    -  组合搜索：支持多字段组合查询（如“模块ID=module001 + 优先级=高 + 关键词=登录”）；
2.  **搜索性能要求**：10万级测试用例数据，单条搜索请求响应时间＜100ms，批量搜索（＜100条）响应时间＜300ms；
3.  **搜索结果要求**
    -  格式：JSON格式，包含用例核心属性、文本高亮片段、相似度分值（与搜索关键词的匹配度）；
    -  排序：支持按相似度、创建时间、优先级自定义排序，默认按相似度降序；
    -  分页：支持分页查询（页码+页大小），页大小最大支持100条；
    -  大模型友好：过滤冗余字段，仅返回核心信息，文本片段长度可配置（默认200字），降低大模型token消耗；
4.  **搜索功能扩展**：支持搜索结果导出（JSON/Markdown格式），可直接传给大模型做二次总结。

#### 3.3.2 对比能力（ES文本相似度对比）
1.  **对比场景支持**
    -  单条用例对比：支持选择1条基准用例，对比多条目标用例的文本相似度；
    -  批量用例对比：支持选择多条用例，批量生成两两对比的相似度矩阵；
    -  指定字段对比：支持指定对比字段（title、steps、expected_result，默认steps+expected_result）；
2.  **对比逻辑要求**
    -  基于ES more_like_this查询API，计算目标用例与基准用例的文本相似度；
    -  支持设置相似度阈值（如50%、80%），筛选符合条件的对比结果；
    -  自动提取文本差异片段（基于分词对比，标注新增/删除/修改内容）；
3.  **对比结果要求**
    -  格式：结构化JSON格式，示例如下（大模型可直接解析）：
      ```json
      {
        "base_case": {
          "case_id": "case001",
          "title": "账号密码错误登录测试",
          "steps": "1. 打开登录页；2. 输入错误账号；3. 输入错误密码；4. 点击登录"
        },
        "target_cases": [
          {
            "case_id": "case002",
            "title": "手机号错误登录测试",
            "similarity_score": 0.75,
            "similarity_level": "中",
            "diff_fields": ["title", "steps"],
            "diff_details": {
              "steps": "差异点：1. 输入内容从「错误账号」改为「错误手机号」；其余步骤一致"
            }
          }
        ]
      }
      ```
    -  包含：基准用例信息、目标用例信息、相似度分值、相似度等级、差异字段、差异详情；
    -  支持导出为Markdown格式，便于大模型总结与人工查看；
4.  **对比性能要求**：单条基准用例对比10条目标用例，响应时间＜500ms；批量对比（≤50条）响应时间＜2000ms。

#### 3.3.3 图谱能力（标准化JSON + ECharts可视化）
1.  **图谱类型支持**
    -  关系图谱：展示用例-用例（依赖/关联/阻塞）、用例-模块的层级关联关系；
    -  场景图谱：展示场景-用例、场景-模块的包含关系；
2.  **标准化JSON数据格式要求**（兼容ECharts，大模型可直接解析）
    ```json
    {
      "nodes": [
        {"id": "case001", "name": "账号密码错误登录", "type": "test_case", "priority": "高", "status": "失败"},
        {"id": "module001", "name": "用户登录模块", "type": "module"},
        {"id": "scene001", "name": "登录异常场景", "type": "scene"}
      ],
      "links": [
        {"source": "case001", "target": "module001", "name": "belongs_to", "desc": "所属模块"},
        {"source": "case001", "target": "scene001", "name": "belongs_to", "desc": "所属场景"}
      ]
    }
    ```
    -  nodes：节点列表，包含唯一ID、节点名称、节点类型、核心属性（优先级、状态等）；
    -  links：关系列表，包含源节点ID、目标节点ID、关系名称、关系描述；
3.  **ECharts可视化需求**
    -  支持力导向图渲染，节点可拖拽、缩放；
    -  支持节点类型筛选（如仅显示测试用例+场景节点）；
    -  支持关系类型筛选（如仅显示“依赖”关系）；
    -  支持节点点击展开/收起关联节点（层级≤5层）；
    -  支持图谱全屏展示与截图导出；
4.  **图谱输出需求**
    -  支持标准化JSON格式导出，可直接传给大模型进行场景覆盖度、依赖瓶颈等分析；
    -  支持按场景ID/用例ID/模块ID导出指定范围的图谱数据，避免全量数据过大。

### 3.4 大模型适配需求
1.  **数据格式统一要求**
    -  全系统对外输出数据仅支持JSON、Markdown两种格式，默认JSON，可选Markdown；
    -  无嵌套过深的结构（嵌套层级≤2层），字段名称简洁规范（英文小写，下划线分隔）；
2.  **数据轻量化要求**
    -  过滤冗余字段（如创建人ID、更新时间戳等非核心信息，可配置保留/过滤）；
    -  文本字段自动截取关键片段（可配置长度），避免大文本占用过多token；
    -  批量数据以数组形式聚合，便于大模型批量解析；
3.  **对接方式要求**
    -  提供REST API接口，输出标准化数据，支持本地开源大模型（Llama 2、Qwen、ChatGLM）直接调用；
    -  API接口支持身份认证（Token验证），保障数据安全；
4.  **功能适配要求**
    -  搜索接口输出结果可直接作为大模型“用例推荐”“搜索结果总结”的输入；
    -  对比接口输出结果可直接作为大模型“差异提炼”“重复用例识别”的输入；
    -  图谱接口输出JSON可直接作为大模型“场景分析”“依赖优化建议”的输入。

### 3.5 业务应用层基础需求
1.  支持测试用例的新增、修改、删除、查询（结构化查询）；
2.  支持用例关系、场景的关联配置与管理；
3.  支持用户权限控制（管理员/普通用户，管理员可操作同步脚本/权限配置）；
4.  支持操作日志记录（谁、何时、执行了何种操作）；
5.  支持核心数据备份（每日自动备份关系库与ES索引）。

## 四、非功能需求
### 4.1 性能需求
| 功能项 | 性能指标 |
|--------|----------|
| ES全文搜索（单条） | 10万级数据，响应时间＜100ms |
| ES全文搜索（批量≤100条） | 响应时间＜300ms |
| 文本相似度对比（1对10） | 响应时间＜500ms |
| 文本相似度对比（批量≤50条） | 响应时间＜2000ms |
| 图谱渲染（≤1000个节点） | 渲染完成时间＜3000ms，无卡顿 |
| 数据同步（全量10万条） | 完成时间＜30分钟 |
| 数据同步（增量≤1000条） | 完成时间＜1分钟 |
| 系统并发请求 | 支持≤500QPS，无服务异常 |

### 4.2 可靠性需求
1.  系统可用性：≥99.9%（年故障时间＜8.76小时）；
2.  数据完整性：数据同步成功率≥99.99%，丢失数据可通过日志与兜底校验修复；
3.  失败重试：核心接口（搜索、对比、同步）支持自动重试3次，重试间隔可配置；
4.  故障告警：同步失败、ES服务不可用、关系库连接失败时，支持日志告警+邮件/钉钉告警；
5.  数据备份：关系库每日自动备份，ES索引每周自动备份，备份数据保留30天。

### 4.3 易用性需求
1.  操作界面：简洁直观，支持搜索、对比、图谱功能的一键操作；
2.  API文档：提供完整的Swagger API文档，包含接口示例、参数说明、返回值说明；
3.  部署难度：支持docker-compose一键部署，部署文档详细，零基础运维人员可完成部署；
4.  学习成本：开发人员掌握SQL、ES DSL、Python基础即可进行二次开发。

### 4.4 可扩展性需求
1.  数据量扩展：ES支持横向增加节点，关系库支持分表，可平滑扩容至百万级用例；
2.  功能扩展：预留向量数据库对接接口，后续可扩展语义搜索功能；
3.  组件扩展：支持同步方案从定时脚本升级为CDC+消息队列（Canal+RabbitMQ），无需重构核心架构；
4.  接口扩展：API接口采用RESTful设计，便于新增功能接口。

### 4.5 安全性需求
1.  权限控制：基于角色的访问控制（RBAC），不同角色拥有不同操作权限；
2.  数据传输：支持HTTPS加密传输，避免数据在传输过程中泄露；
3.  数据存储：敏感字段（如执行人手机号）支持加密存储；
4.  日志审计：所有操作日志留存90天，支持追溯异常操作；
5.  访问控制：支持IP白名单配置，仅允许指定IP段访问系统。

### 4.6 兼容性需求
1.  操作系统：支持Linux（CentOS 7+/Ubuntu 18.04+），兼容Windows Server 2019+；
2.  大模型：兼容主流开源大模型（Llama 2、Qwen、ChatGLM、Baichuan）；
3.  浏览器：支持Chrome（≥80）、Firefox（≥75）、Edge（≥80）；
4.  数据库：兼容MySQL 8.0+、PostgreSQL 14+。

## 五、落地保障需求
### 5.1 环境准备需求
1.  服务器配置：最低2核4G内存，50G磁盘空间（10万级数据）；
2.  软件环境：Java 11+（ES运行依赖）、Python 3.8+、MySQL/PostgreSQL、Docker（可选）；
3.  网络环境：支持服务器内网通信，无需公网访问（私有化部署），如需外网访问需配置防火墙。

### 5.2 开发规范需求
1.  代码规范：遵循Python PEP 8规范、Java阿里巴巴开发手册（若使用Java）；
2.  接口规范：遵循RESTful API设计规范，统一返回格式（code、msg、data）；
3.  数据格式规范：JSON字段名称统一为英文小写+下划线，枚举值统一管理；
4.  日志规范：采用分级日志（DEBUG/INFO/WARN/ERROR），日志格式统一，包含时间、模块、内容、异常堆栈。

### 5.3 测试要求
1.  功能测试：覆盖所有核心功能，测试用例通过率100%；
2.  性能测试：针对搜索、对比、同步功能进行压力测试，满足性能指标要求；
3.  兼容性测试：在指定操作系统、浏览器、大模型环境下完成兼容性验证；
4.  安全测试：进行权限越权、SQL注入、接口攻击等安全测试，无高危漏洞。

### 5.4 文档要求
1.  部署文档：包含环境准备、组件安装、配置修改、一键部署、故障排查；
2.  使用文档：包含用户操作指南、API调用指南、同步脚本配置指南；
3.  设计文档：包含架构设计、表结构设计、ES索引设计、接口设计；
4.  测试文档：包含测试用例、测试报告、性能测试结果。

### 5.5 运维要求
1.  监控需求：支持ES集群状态、关系库连接状态、同步脚本运行状态监控；
2.  故障排查：提供故障排查手册，包含常见问题、排查步骤、解决方案；
3.  手动干预：支持手动触发同步、手动备份数据、手动修复ES索引；
4.  版本升级：支持平滑升级，不影响业务正常运行。

## 六、风险与应对措施
| 风险类型 | 风险描述 | 应对措施 |
|----------|----------|----------|
| 数据同步延迟 | 定时同步存在30分钟内延迟，影响实时搜索场景 | 1.  支持手动触发同步，满足紧急需求；2.  核心业务场景可配置更短同步间隔（如5分钟）；3.  前端提示数据同步状态 |
| ES索引性能下降 | 长期运行后，ES索引碎片过多，导致搜索性能下降 | 1.  定期（每周）执行ES索引优化（_forcemerge）；2.  按时间分索引，避免单索引过大；3.  监控索引碎片率，及时处理 |
| 大模型解析异常 | 数据格式不规范，导致大模型解析失败或总结偏差 | 1.  严格遵循数据格式规范，提供字段说明文档；2.  输出数据前进行格式校验；3.  提供示例数据，便于大模型适配 |
| 系统可用性风险 | ES/关系库服务不可用，导致核心功能异常 | 1.  配置服务自动重启；2.  部署ES副本、关系库主从备份；3.  核心接口添加服务状态判断，返回友好提示 |
| 文本对比精度不足 | ES TF-IDF算法对比精度无法满足业务需求 | 1.  支持自定义相似度字段权重；2.  预留接口，后续可集成第三方文本对比算法；3.  优化IK分词配置，提升文本匹配精度 |

## 七、附录
### 附录A：ES索引映射示例
```json
{
  "mappings": {
    "properties": {
      "case_id": {"type": "keyword"},
      "title": {
        "type": "text",
        "analyzer": "ik_max_word",
        "search_analyzer": "ik_smart",
        "fields": {"keyword": {"type": "keyword"}}
      },
      "module_id": {"type": "keyword"},
      "module_name": {
        "type": "text",
        "analyzer": "ik_smart",
        "fields": {"keyword": {"type": "keyword"}}
      },
      "priority": {"type": "keyword"},
      "status": {"type": "keyword"},
      "steps": {
        "type": "text",
        "analyzer": "ik_max_word",
        "similarity": "BM25"
      },
      "expected_result": {
        "type": "text",
        "analyzer": "ik_max_word",
        "similarity": "BM25"
      },
      "executor": {"type": "keyword"},
      "create_time": {"type": "date", "format": "yyyy-MM-dd HH:mm:ss"},
      "scene_ids": {"type": "keyword"},
      "scene_names": {
        "type": "text",
        "analyzer": "ik_smart"
      }
    }
  }
}
```

### 附录B：图谱JSON格式示例
见3.3.3节图谱能力需求

### 附录C：对比结果JSON格式示例
见3.3.2节对比能力需求